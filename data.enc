const fs = require("fs");
const crypto = require("crypto");

const password = "Test"; // mot de passe du site
const content = `
<h1>Infos familiales</h1>
<p>Texte privé ici</p>
`;

const salt = crypto.randomBytes(16);
const iv = crypto.randomBytes(12);

crypto.pbkdf2(password, salt, 100000, 32, "sha256", (err, key) => {
  if (err) throw err;

  const cipher = crypto.createCipheriv("aes-256-gcm", key, iv);

  const encrypted = Buffer.concat([
    cipher.update(content, "utf8"),
    cipher.final(),
  ]);

  const tag = cipher.getAuthTag();

  // IMPORTANT : ordre attendu par le navigateur
  const output = Buffer.concat([
    salt,      // 16 bytes
    iv,        // 12 bytes
    tag,       // 16 bytes
    encrypted, // data
  ]);

  fs.writeFileSync("data.enc", output.toString("base64"));
  console.log("✅ data.enc généré");
});
